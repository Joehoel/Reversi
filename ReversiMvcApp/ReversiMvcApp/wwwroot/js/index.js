var g=Object.defineProperty,y=Object.defineProperties;var w=Object.getOwnPropertyDescriptors;var f=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable;var h=(s,e,t)=>e in s?g(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,p=(s,e)=>{for(var t in e||(e={}))k.call(e,t)&&h(s,t,e[t]);if(f)for(var t of f(e))b.call(e,t)&&h(s,t,e[t]);return s},m=(s,e)=>y(s,w(e));var a=(s,e,t)=>(h(s,typeof e!="symbol"?e+"":e,t),t);import{C as v,H as E,a as C}from"./vendor.js";const S=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerpolicy&&(n.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?n.credentials="include":o.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(o){if(o.ep)return;o.ep=!0;const n=t(o);fetch(o.href,n)}};S();class T{constructor(e){a(this,"ctx");a(this,"chart");var t;this.ctx=(t=document.querySelector(e))==null?void 0:t.getContext("2d"),this.chart=new v(this.ctx,{type:"doughnut",data:{labels:["Black","White"],datasets:[{data:[1,1],backgroundColor:["#2A2D34","#EFE9F4"],borderColor:["#191b1f","#b4adba"]}]}})}update(e){let t=0,r=0;e.forEach(n=>{n.forEach(i=>{switch(i){case 1:t++;break;case 2:r++;break}})});const o=this.chart.data.datasets[0];this.chart.data.datasets[0]=m(p({},o),{data:[r,t]}),this.chart.update()}}class L{constructor(e,t,r){a(this,"url");a(this,"token");a(this,"playerToken");a(this,"grid",new Map);a(this,"board",[[]]);a(this,"connection");a(this,"stats");this.url=e,this.token=t,this.playerToken=r,this.connection=new E().withUrl("/hub").build(),this.stats=new T("#stats");const n=document.querySelector(".grid").querySelectorAll(".grid__row"),i=document.querySelector("#concede");i==null||i.addEventListener("click",()=>this.concede()),n.forEach(c=>{const d=new Map;c.querySelectorAll(".grid__column").forEach(l=>{d.set(l.dataset.column,l)}),this.grid.set(c.dataset.row,d)});for(const[c,d]of this.grid.entries())for(const[u,l]of d.entries())l.addEventListener("click",()=>{this.move({column:parseInt(u),row:parseInt(c)})})}async concede(){const e=await fetch(`${this.url}/concede`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:this.token,playerToken:this.playerToken})});if(e.ok)this.redirect(`/Games/Results/${this.token}`);else{const t=await e.text();alert(t)}}async init(){try{await this.connection.start(),await this.updateBoard(),this.connection.state===C.Connected&&(console.log("Connected"),this.connection.invoke("Join",this.token),this.connection.on("message",e=>console.log(`Message: ${e}`)),this.connection.on("move",async()=>{await this.updateBoard()}))}catch(e){console.error(e)}}redirect(e){window.location.href=encodeURI(`${window.location.origin}${e}`)}async updateBoard(){console.log("Updating");const t=await(await fetch(`${this.url}/${this.token}`)).json();console.log(t),this.board=t.board,this.board.forEach((r,o)=>{r.forEach((n,i)=>{this.showFiche({color:n,column:i,row:o})})}),this.stats.update(this.board)}async move({column:e,row:t}){const r={playerToken:this.playerToken,token:this.token,row:t,column:e},o=await fetch(`${this.url}/move`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(o.ok)this.connection.invoke("Move",this.token);else{const n=await o.text();n.toLowerCase()==="game over"?this.redirect(`/Games/Results/${this.token}`):alert(n)}}showFiche({color:e,column:t,row:r}){var c;if(e===0||typeof e=="undefined")return;const o={"1":"white","2":"black"},n=document.createElement("span");n.classList.add("fiche",`fiche--${o[e]}`);const i=(c=this.grid.get(r.toString()))==null?void 0:c.get(t.toString());i&&(i.childNodes.forEach(d=>d.remove()),i.appendChild(n)),this.board&&(this.board[r][t]=e)}}async function $(){var r;const s=decodeURIComponent(window.location.href.split("/").at(-1)),e=(r=document.querySelector("#playerToken"))==null?void 0:r.value;console.log(e),await new L("https://localhost:6001/api/game",s,e).init()}document.addEventListener("DOMContentLoaded",()=>{try{$()}catch(s){console.error(s)}});
//# sourceMappingURL=index.js.map
